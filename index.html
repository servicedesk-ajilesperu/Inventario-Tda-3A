<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Inventario Tiendas 3A</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
/* ----------- Estilos Generales ----------- */
body, html { margin:0; padding:0; font-family:sans-serif; background:#f7f7f7; }
* { box-sizing: border-box; }

/* Sidebar */
.sidebar { width:260px; position:fixed; height:100%; background:#ff4d00; color:white; display:flex; flex-direction:column; gap:12px; padding:20px; transition:0.3s; overflow-y:auto; z-index:10; }
.sidebar.collapsed { width:60px; padding:20px 5px; }
.brand { display:flex; align-items:center; gap:10px; font-weight:700; font-size:1.2rem; position:relative; margin-bottom:10px; }
#toggleSidebar { position:absolute; right:0; top:0; background:#cc3c00; color:white; border:none; border-radius:6px; padding:4px 8px; cursor:pointer; }

/* Acordeón del Menú */
.menu-section .accordion { background:transparent; color:white; border:none; padding:10px; width:100%; display:flex; align-items:center; gap:10px; cursor:pointer; font-weight:600; justify-content:space-between; border-radius:4px; transition:0.2s; }
.menu-section .accordion.active, .menu-section .accordion:hover { background-color:#e64500; }
.menu-section .panel { padding:0 10px; max-height:0; overflow:hidden; transition:max-height 0.3s ease-in-out; background-color:#e64500; display:flex; flex-direction:column; gap:4px; }
.menu-section .panel button { background:transparent; color:white; border:none; padding:8px; text-align:left; display:flex; align-items:center; gap:6px; cursor:pointer; width:100%; border-radius:4px; }
.menu-section .panel button:hover { background-color:#cc4000; }

/* Sidebar colapsado */
.sidebar.collapsed .brand span,
.sidebar.collapsed .menu-section .accordion span,
.sidebar.collapsed .panel button span { display:none; }
.sidebar.collapsed .accordion { justify-content:center; }
.sidebar.collapsed .accordion i.fa-chevron-down { display:none; }

/* Contenido principal */
.main { margin-left:260px; padding:20px; transition:0.3s; }
.sidebar.collapsed ~ .main { margin-left:60px; }

/* Cards Dashboard */
.cards { display:flex; gap:20px; margin-top:20px; flex-wrap:wrap; }
.card { flex:1; min-width:150px; background:white; color:#ff4d00; padding:20px; border-radius:12px; text-align:center; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.1); transition:0.2s; }
.card:hover { transform:translateY(-3px); box-shadow:0 6px 12px rgba(0,0,0,0.15); }
.card span { font-weight:700; font-size:1.3rem; display:block; margin-top:5px; }
.card i { font-size:2rem; }

/* Buscador */
.search-bar { margin-bottom:15px; display:flex; gap:10px; }
.search-bar input { flex-grow:1; padding:10px; border-radius:6px; border:1px solid #ccc; font-size:1rem; }

/* Tabla */
table { width:100%; border-collapse:collapse; margin-top:20px; background:white; box-shadow:0 2px 4px rgba(0,0,0,0.05); }
th, td { border:1px solid #eee; padding:10px; text-align:center; font-size:0.9rem; }
th { background:#ff4d00; color:white; font-weight:600; }
tr:nth-child(even) { background-color:#f9f9f9; }
.actions button { margin:0 2px; padding:6px; border-radius:50%; border:none; cursor:pointer; width:32px; height:32px; transition:0.1s; }
.actions button:hover { opacity:0.8; }
.btn-edit { background:#ffb86b; color:white; }
.btn-del { background:#d9534f; color:white; }

/* Modal */
.modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index:50; }
.modal { background:white; padding:25px; border-radius:12px; width:450px; max-width:95%; box-shadow:0 10px 20px rgba(0,0,0,0.2); }
input, select { padding:10px; border-radius:6px; border:1px solid #ccc; width:100%; margin-bottom:12px; font-size:1rem; }
.modal button { padding:8px 15px; border-radius:6px; cursor:pointer; border:none; font-weight:600; transition:0.1s; }
.modal button:last-child { background:#ff4d00; color:white; }
.modal button:last-child:hover { background:#cc3c00; }
.modal button:first-child { background:#eee; color:#333; margin-right:10px; }
.modal button:first-child:hover { background:#ddd; }

/* Responsive */
@media(max-width:768px){
.sidebar { left:-260px; position:fixed; }
.sidebar.collapsed { left:0; }
.main { margin-left:0; padding:10px; }
.cards { flex-direction:column; }
.card { min-width:100%; }
}
</style>
</head>
<body>

<aside class="sidebar" id="sidebar">
<div class="brand"><i class="fa-solid fa-boxes-stacked"></i><span>Inventario 3A</span>
<button id="toggleSidebar"><i class="fa-solid fa-bars"></i></button></div>

<div class="menu-section">
<button class="accordion active"><i class="fa-solid fa-house"></i><span>Dashboard</span><i class="fa-solid fa-chevron-down"></i></button>
<div class="panel" style="max-height: 500px;">
<button onclick="nav('dashboard')"><i class="fa-solid fa-gauge-high"></i><span>Ver Dashboard</span></button>
</div>
</div>

<div class="menu-section">
<button class="accordion"><i class="fa-solid fa-computer"></i><span>Inventario</span><i class="fa-solid fa-chevron-down"></i></button>
<div class="panel">
<button onclick="openAddForm('inventario')"><i class="fa-solid fa-plus"></i><span>Agregar Inventario</span></button>
<button onclick="nav('inventario')"><i class="fa-solid fa-table"></i><span>Ver Inventario</span></button>
</div>
</div>

<div class="menu-section">
<button class="accordion"><i class="fa-solid fa-tags"></i><span>Categorías</span><i class="fa-solid fa-chevron-down"></i></button>
<div class="panel">
<button onclick="openAddForm('categoria')"><i class="fa-solid fa-plus"></i><span>Agregar Categoría</span></button>
<button onclick="nav('categoria')"><i class="fa-solid fa-table"></i><span>Ver Categorías</span></button>
</div>
</div>

<div class="menu-section">
<button class="accordion"><i class="fa-solid fa-store"></i><span>Tiendas</span><i class="fa-solid fa-chevron-down"></i></button>
<div class="panel">
<button onclick="openAddForm('tienda')"><i class="fa-solid fa-plus"></i><span>Agregar Tienda</span></button>
<button onclick="nav('tienda')"><i class="fa-solid fa-table"></i><span>Ver Tiendas</span></button>
</div>
</div>
</aside>

<div class="main">
<h2 id="main-title">Inventario de Tienda</h2>
<div id="content"></div>
</div>

<div class="modal-backdrop" id="modal">
<div class="modal">
<h3 id="modal-title"></h3>
<div id="modal-form"></div>
<div style="text-align:right; margin-top:15px;">
<button onclick="closeModal()">Cancelar</button>
<button onclick="saveItem()">Guardar</button>
</div>
</div>
</div>

<script>
const APPWEB_URL = "https://script.google.com/macros/s/AKfycbz5af-9YvEbD_2Lkwss6xPhBXqh9UEaqMqHIQ1OdXrv44SSxsYYa47Z5x4e6LFyPHFN/exec";
let currentSheet = '';
let editId = null;

// Sidebar Toggle
document.getElementById('toggleSidebar').onclick = ()=>{ document.getElementById('sidebar').classList.toggle('collapsed'); }

// Acordeón
document.querySelectorAll('.accordion').forEach(acc => {
  acc.onclick = function() {
    this.classList.toggle("active");
    const panel = this.nextElementSibling;
    if(panel.style.maxHeight) panel.style.maxHeight = null;
    else panel.style.maxHeight = panel.scrollHeight + "px";
  }
});

// Navegación
function nav(sheet){
  currentSheet = sheet;
  editId = null;
  document.getElementById('main-title').innerText = sheet.charAt(0).toUpperCase() + sheet.slice(1);
  fetchData();
}

// Modal
function openAddForm(sheet){
  currentSheet = sheet;
  editId = null;
  document.getElementById('modal-title').innerText = 'Agregar ' + sheet;
  buildForm(sheet);
  document.getElementById('modal').style.display = 'flex';
}

function closeModal(){ document.getElementById('modal').style.display='none'; }

// Construir formulario dinámico
async function buildForm(sheet){
  let html='';
  const data = await fetch(`${APPWEB_URL}?sheet=${sheet}&action=get`).then(r=>r.json());
  if(sheet==='inventario'){
    // Combo de Categoría
    const categorias = await fetch(`${APPWEB_URL}?sheet=categoria&action=get`).then(r=>r.json());
    const tiendas = await fetch(`${APPWEB_URL}?sheet=tienda&action=get`).then(r=>r.json());
    html+=`<label>Nombre:</label><input type="text" id="name" value="${editId ? data.find(x=>x.id==editId).Nombre : ''}"/>`;
    html+=`<label>Categoría:</label><input list="catlist" id="categoria" value="${editId ? data.find(x=>x.id==editId).Categoria : ''}"/><datalist id="catlist">${categorias.map(c=>`<option value="${c.Nombre}">`).join('')}</datalist>`;
    html+=`<label>Tienda:</label><input list="tdlist" id="tienda" value="${editId ? data.find(x=>x.id==editId).Tienda : ''}"/><datalist id="tdlist">${tiendas.map(t=>`<option value="${t.Nombre}">`).join('')}</datalist>`;
    html+=`<label>Cantidad:</label><input type="number" id="cantidad" value="${editId ? data.find(x=>x.id==editId).Cantidad : ''}"/>`;
  } else {
    html+=`<label>Nombre:</label><input type="text" id="name" value="${editId ? data.find(x=>x.id==editId).Nombre : ''}"/>`;
  }
  document.getElementById('modal-form').innerHTML=html;
}

// Guardar Item
function saveItem(){
  const params={sheet:currentSheet};
  if(currentSheet==='inventario'){
    params.Nombre = document.getElementById('name').value;
    params.Categoria = document.getElementById('categoria').value;
    params.Tienda = document.getElementById('tienda').value;
    params.Cantidad = document.getElementById('cantidad').value;
  } else {
    params.Nombre = document.getElementById('name').value;
  }
  let url = APPWEB_URL+'?sheet='+currentSheet;
  if(editId){
    params.action='update';
    params.idCol='id';
    params.idValue=editId;
  } else {
    params.action='add';
  }
  const formData = new URLSearchParams(params);
  fetch(url,{method:'POST',body:formData}).then(r=>r.json()).then(r=>{
    if(r.success){
      closeModal();
      fetchData();
    } else alert(r.msg);
  });
}

// Cargar tabla
async function fetchData(){
  const data = await fetch(`${APPWEB_URL}?sheet=${currentSheet}&action=get`).then(r=>r.json());
  if(!data.length){ document.getElementById('content').innerHTML='<p>No hay registros.</p>'; return; }
  const headers=Object.keys(data[0]);
  let table=`<div class="search-bar"><input placeholder="Buscar..." oninput="filterTable(this.value)"/></div><table><tr>${headers.map(h=>`<th>${h}</th>`).join('')}<th>Acciones</th></tr>`;
  data.forEach(row=>{
    table+=`<tr>${headers.map(h=>`<td>${row[h]}</td>`).join('')}<td class="actions"><button class="btn-edit" onclick="editItem(${row.id})"><i class="fa-solid fa-pen"></i></button><button class="btn-del" onclick="delItem(${row.id})"><i class="fa-solid fa-trash"></i></button></td></tr>`;
  });
  table+='</table>';
  document.getElementById('content').innerHTML=table;
}

// Editar
function editItem(id){ editId=id; openAddForm(currentSheet); }

// Eliminar
function delItem(id){
  if(confirm('¿Eliminar este registro?')){
    const params = new URLSearchParams({sheet:currentSheet, action:'delete', idValue:id});
    fetch(APPWEB_URL,{method:'POST',body:params}).then(r=>r.json()).then(r=>{
      if(r.success) fetchData();
      else alert(r.msg);
    });
  }
}

// Filtrar tabla
function filterTable(text){
  const trs=document.querySelectorAll('#content table tr');
  trs.forEach((tr,i)=>{
    if(i===0) return;
    tr.style.display = tr.innerText.toLowerCase().includes(text.toLowerCase())?'':'none';
  });
}
</script>
</body>
</html>
