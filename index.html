<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventario Tiendas 3A</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --primary:#ff6b00; /* Naranja principal */
      --dark:#333;
      --light:#f9f9f9;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:Arial, sans-serif;display:flex;height:100vh;color:var(--dark)}
    /* Sidebar */
    #sidebar{width:70px;background:var(--primary);display:flex;flex-direction:column;align-items:center;padding:1rem 0;transition:width .3s}
    #sidebar:hover{width:200px}
    #sidebar a{color:#fff;text-decoration:none;width:100%;padding:1rem;display:flex;align-items:center;gap:.5rem;white-space:nowrap}
    #sidebar i{min-width:20px}
    /* Main */
    #main{flex:1;display:flex;flex-direction:column;background:var(--light)}
    header{background:var(--primary);color:#fff;padding:1rem;font-size:1.2rem}
    #content{flex:1;overflow:auto;padding:1rem}
    /* Dashboard cards */
    .cards{display:flex;gap:1rem;margin-bottom:1rem;flex-wrap:wrap}
    .card{flex:1;min-width:200px;background:#fff;padding:1rem;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);cursor:pointer;text-align:center}
    .card i{font-size:2rem;color:var(--primary);margin-bottom:.5rem}
    /* Tables */
    table{width:100%;border-collapse:collapse;margin-top:1rem;background:#fff}
    th,td{padding:.5rem;border:1px solid #ddd;text-align:left}
    th{background:var(--primary);color:#fff}
    td.actions{display:flex;gap:.5rem}
    button{padding:.3rem .6rem;border:none;border-radius:4px;cursor:pointer}
    .btn-edit{background:#0f62fe;color:#fff}
    .btn-del{background:#e74c3c;color:#fff}
    .btn-add{background:var(--primary);color:#fff;margin:1rem 0;padding:.5rem 1rem}
    /* Modal */
    .modal{position:fixed;top:0;left:0;width:100%;height:100%;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5)}
    .modal-content{background:#fff;padding:1rem;border-radius:10px;width:90%;max-width:500px}
    .modal-content h3{margin-bottom:1rem}
    .modal-content label{display:block;margin:.5rem 0 .2rem}
    .modal-content input, .modal-content select{width:100%;padding:.5rem;margin-bottom:.5rem}
    .modal-content .actions{display:flex;justify-content:flex-end;gap:.5rem}
  </style>
</head>
<body>
  <!-- Sidebar -->
  <nav id="sidebar">
    <a href="#" onclick="nav('dashboard')"><i class="fa-solid fa-chart-pie"></i><span>Dashboard</span></a>
    <a href="#" onclick="nav('inventario')"><i class="fa-solid fa-computer"></i><span>Inventario</span></a>
    <a href="#" onclick="nav('categorias')"><i class="fa-solid fa-tags"></i><span>Categorías</span></a>
    <a href="#" onclick="nav('tiendas')"><i class="fa-solid fa-store"></i><span>Tiendas</span></a>
  </nav>

  <div id="main">
    <header>Inventario Tiendas 3A</header>
    <div id="content"></div>
  </div>

  <!-- Modal Inventario -->
  <div id="modal" class="modal">
    <div class="modal-content">
      <h3 id="modal-title">Agregar Equipo</h3>
      <form id="formInventario">
        <input type="hidden" id="editIndex">
        <label>Código</label>
        <input type="text" id="codigo" required>
        <label>Serie</label>
        <input type="text" id="serie" required>
        <label>Equipo</label>
        <input type="text" id="equipo" required>
        <label>Marca</label>
        <input type="text" id="marca" required>
        <label>Modelo</label>
        <input type="text" id="modelo" required>
        <label>Categoría</label>
        <input type="text" id="categoria" required>
        <label>Tienda</label>
        <input type="text" id="tienda" required>
        <div class="actions">
          <button type="button" onclick="closeModal()">Cancelar</button>
          <button type="submit">Guardar</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    const scriptURL="https://script.google.com/macros/s/AKfycbz5af-9YvEbD_2Lkwss6xPhBXqh9UEaqMqHIQ1OdXrv44SSxsYYa47Z5x4e6LFyPHFN/exec";
    let view="dashboard";
    let inventario=[],categorias=[],tiendas=[];

    // Navegación
    function nav(v){ view=v; render(); }

    // Render principal
    function render(){
      let c=document.getElementById("content");
      c.innerHTML="";
      if(view==="dashboard"){
        c.innerHTML=`
          <div class="cards">
            <div class="card" onclick="nav('inventario')"><i class="fa-solid fa-computer"></i><h4>Inventario</h4><small>${inventario.length} registros</small></div>
            <div class="card" onclick="nav('categorias')"><i class="fa-solid fa-tags"></i><h4>Categorías</h4><small>${categorias.length} registros</small></div>
            <div class="card" onclick="nav('tiendas')"><i class="fa-solid fa-store"></i><h4>Tiendas</h4><small>${tiendas.length} registros</small></div>
          </div>`;
      }
      if(view==="inventario"){
        c.innerHTML=`<button class="btn-add" onclick="openModal()">+ Agregar Equipo</button>
          <table><thead><tr><th>Código</th><th>Serie</th><th>Equipo</th><th>Marca</th><th>Modelo</th><th>Categoría</th><th>Tienda</th><th>Acciones</th></tr></thead><tbody>
          ${inventario.map((r,i)=>`
            <tr>
              <td>${r.Codigo}</td><td>${r.Serie}</td><td>${r.Equipo}</td><td>${r.Marca}</td><td>${r.Modelo}</td><td>${r.Categoria}</td><td>${r.Tienda}</td>
              <td class="actions">
                <button class="btn-edit" onclick="editItem(${i})"><i class="fa-solid fa-pen"></i></button>
                <button class="btn-del" onclick="deleteItem(${i})"><i class="fa-solid fa-trash"></i></button>
              </td>
            </tr>`).join("")}
          </tbody></table>`;
      }
    }

    // Modal
    function openModal(i=null){
      document.getElementById("modal").style.display="flex";
      if(i!==null){
        document.getElementById("modal-title").innerText="Editar Equipo";
        document.getElementById("editIndex").value=i;
        let r=inventario[i];
        document.getElementById("codigo").value=r.Codigo;
        document.getElementById("serie").value=r.Serie;
        document.getElementById("equipo").value=r.Equipo;
        document.getElementById("marca").value=r.Marca;
        document.getElementById("modelo").value=r.Modelo;
        document.getElementById("categoria").value=r.Categoria;
        document.getElementById("tienda").value=r.Tienda;
      } else {
        document.getElementById("modal-title").innerText="Agregar Equipo";
        document.getElementById("formInventario").reset();
        document.getElementById("editIndex").value="";
      }
    }
    function closeModal(){document.getElementById("modal").style.display="none";}

    // Guardar
    document.getElementById("formInventario").addEventListener("submit",e=>{
      e.preventDefault();
      const data={
        Codigo:codigo.value,Serie:serie.value,Equipo:equipo.value,Marca:marca.value,
        Modelo:modelo.value,Categoria:categoria.value,Tienda:tienda.value
      };
      let idx=document.getElementById("editIndex").value;
      if(idx===""){
        inventario.push(data);
        fetch(`${scriptURL}?sheet=Inventario&action=add&Codigo=${data.Codigo}&Serie=${data.Serie}&Equipo=${data.Equipo}&Marca=${data.Marca}&Modelo=${data.Modelo}&Categoria=${data.Categoria}&Tienda=${data.Tienda}`);
      }else{
        inventario[idx]=data;
        fetch(`${scriptURL}?sheet=Inventario&action=update&idCol=Codigo&idValue=${data.Codigo}&Serie=${data.Serie}&Equipo=${data.Equipo}&Marca=${data.Marca}&Modelo=${data.Modelo}&Categoria=${data.Categoria}&Tienda=${data.Tienda}`);
      }
      closeModal(); render();
    });

    // Editar / Eliminar
    function editItem(i){openModal(i);}
    function deleteItem(i){
      let code=inventario[i].Codigo;
      inventario.splice(i,1);
      render();
      fetch(`${scriptURL}?sheet=Inventario&action=delete&idCol=Codigo&idValue=${code}`);
    }

    // Inicial
    async function init(){
      let res=await fetch(`${scriptURL}?sheet=Inventario&action=get`);
      inventario=await res.json();
      render();
    }
    init();
  </script>
</body>
</html>
