<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventario Tiendas 3A</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      margin: 0; padding: 0;
    }
    h1 {
      text-align: center;
      background: #ff7b00;
      color: white;
      margin: 0;
      padding: 15px;
    }
    .accordion {
      width: 90%;
      margin: 15px auto;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }
    .accordion button {
      background: #ffb347;
      color: #333;
      cursor: pointer;
      padding: 14px;
      width: 100%;
      border: none;
      text-align: left;
      font-size: 16px;
      font-weight: bold;
    }
    .accordion button.active {
      background: #ff7b00;
      color: #fff;
    }
    .panel {
      padding: 10px;
      display: none;
      background: #fff;
      overflow-x: auto;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    .btn {
      cursor: pointer;
      border: none;
      padding: 6px 12px;
      margin: 2px;
      border-radius: 4px;
    }
    .btn-add { background: #4CAF50; color: white; }
    .btn-edit { background: #2196F3; color: white; }
    .btn-delete { background: #f44336; color: white; }
  </style>
</head>
<body>

<h1>Inventario Tiendas 3A</h1>

<div class="accordion">
  <button class="accordion-btn">üì¶ Inventario</button>
  <div class="panel">
    <button class="btn btn-add" onclick="showForm('Inventario')">‚ûï Agregar</button>
    <table id="InventarioTable"></table>
  </div>
</div>

<div class="accordion">
  <button class="accordion-btn">üìÇ Categor√≠as</button>
  <div class="panel">
    <button class="btn btn-add" onclick="showForm('Categorias')">‚ûï Agregar</button>
    <table id="CategoriasTable"></table>
  </div>
</div>

<div class="accordion">
  <button class="accordion-btn">üè¨ Tiendas</button>
  <div class="panel">
    <button class="btn btn-add" onclick="showForm('Tiendas')">‚ûï Agregar</button>
    <table id="TiendasTable"></table>
  </div>
</div>

<!-- Modal para formulario -->
<div id="formModal" style="display:none; position:fixed; top:0; left:0; right:0; bottom:0; background:rgba(0,0,0,0.5);">
  <div style="background:#fff; width:400px; margin:10% auto; padding:20px; border-radius:8px;">
    <h3 id="formTitle"></h3>
    <form id="dataForm"></form>
    <button type="button" class="btn btn-add" onclick="saveData()">Guardar</button>
    <button type="button" class="btn btn-delete" onclick="closeForm()">Cancelar</button>
  </div>
</div>

<script>
const API_URL = "TU_URL_DEL_SCRIPT"; // <-- pega aqu√≠ tu URL de despliegue Apps Script

let currentSheet = "";
let editId = null;

// ====== ACCORDION ======
document.querySelectorAll(".accordion-btn").forEach(btn => {
  btn.addEventListener("click", function() {
    document.querySelectorAll(".accordion-btn").forEach(b => b.classList.remove("active"));
    document.querySelectorAll(".panel").forEach(p => p.style.display = "none");
    this.classList.add("active");
    this.nextElementSibling.style.display = "block";
  });
});

// ====== CARGAR DATOS ======
async function loadData(sheet) {
  const res = await fetch(`${API_URL}?sheet=${sheet}&action=get`);
  const data = await res.json();
  renderTable(sheet, data);
}

function renderTable(sheet, data) {
  const table = document.getElementById(sheet + "Table");
  if (!data || data.length === 0) {
    table.innerHTML = "<tr><td>No hay registros</td></tr>";
    return;
  }

  let html = "<tr>";
  Object.keys(data[0]).forEach(h => {
    if (h !== "idSheet") html += `<th>${h}</th>`;
  });
  html += "<th>Acciones</th></tr>";

  data.forEach(row => {
    html += "<tr>";
    Object.keys(row).forEach(h => {
      if (h !== "idSheet") html += `<td>${row[h]}</td>`;
    });
    html += `
      <td>
        <button class="btn btn-edit" onclick="editData('${sheet}', '${row.id}')">Editar</button>
        <button class="btn btn-delete" onclick="deleteData('${sheet}', '${row.id}')">Eliminar</button>
      </td>`;
    html += "</tr>";
  });
  table.innerHTML = html;
}

// ====== FORMULARIO ======
function showForm(sheet, data = {}) {
  currentSheet = sheet;
  editId = data.id || null;
  document.getElementById("formTitle").innerText = (editId ? "Editar " : "Agregar ") + sheet;

  const form = document.getElementById("dataForm");
  form.innerHTML = "";

  if (sheet === "Inventario") {
    form.innerHTML += `<label>C√≥digo:</label><input name="Codigo" value="${data.Codigo||""}"><br>`;
    form.innerHTML += `<label>Serie:</label><input name="Serie" value="${data.Serie||""}"><br>`;
    form.innerHTML += `<label>Equipo:</label><input name="Equipo" value="${data.Equipo||""}"><br>`;
    form.innerHTML += `<label>Marca:</label><input name="Marca" value="${data.Marca||""}"><br>`;
    form.innerHTML += `<label>Modelo:</label><input name="Modelo" value="${data.Modelo||""}"><br>`;
    form.innerHTML += `<label>Categor√≠a:</label><input name="Categoria" value="${data.Categoria||""}"><br>`;
    form.innerHTML += `<label>Tienda:</label><input name="Tienda" value="${data.Tienda||""}"><br>`;
  } else {
    form.innerHTML += `<label>Nombre:</label><input name="nombre" value="${data.nombre||""}"><br>`;
  }

  document.getElementById("formModal").style.display = "block";
}

function closeForm() {
  document.getElementById("formModal").style.display = "none";
}

// ====== GUARDAR ======
async function saveData() {
  const form = document.getElementById("dataForm");
  const formData = new FormData(form);
  let params = new URLSearchParams();
  params.append("sheet", currentSheet);
  params.append("action", editId ? "update" : "add");
  if (editId) params.append("id", editId);

  for (let [k,v] of formData.entries()) {
    params.append(k, v);
  }

  await fetch(API_URL, { method: "POST", body: params });
  closeForm();
  loadData(currentSheet);
}

// ====== EDITAR ======
async function editData(sheet, id) {
  const res = await fetch(`${API_URL}?sheet=${sheet}&action=get`);
  const data = await res.json();
  const record = data.find(r => r.id == id);
  showForm(sheet, record);
}

// ====== ELIMINAR ======
async function deleteData(sheet, id) {
  if (!confirm("¬øSeguro de eliminar este registro?")) return;
  let params = new URLSearchParams();
  params.append("sheet", sheet);
  params.append("action", "delete");
  params.append("id", id);

  await fetch(API_URL, { method: "POST", body: params });
  loadData(sheet);
}

// ====== AUTOLOAD ======
loadData("Inventario");
loadData("Categorias");
loadData("Tiendas");
</script>
</body>
</html>
