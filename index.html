<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Inventario Tiendas 3A</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
<style>
/* ðŸŽ¨ Estilos originales */
body, html { margin:0; padding:0; font-family:sans-serif; background:#f7f7f7; }
* { box-sizing:border-box; }
.sidebar { width:260px; position:fixed; height:100%; background:#ff4d00; color:white; display:flex; flex-direction:column; gap:12px; padding:20px; transition:0.3s; overflow-y:auto; z-index:10; }
.sidebar.collapsed { width:60px; padding:20px 5px; }
.brand { display:flex; align-items:center; gap:10px; font-weight:700; font-size:1.2rem; position:relative; margin-bottom:10px; }
#toggleSidebar { position:absolute; right:0; top:0; background:#cc3c00; color:white; border:none; border-radius:6px; padding:4px 8px; cursor:pointer; }
.menu-section .accordion { background:transparent; color:white; border:none; padding:10px; width:100%; display:flex; align-items:center; gap:10px; cursor:pointer; font-weight:600; justify-content:space-between; border-radius:4px; }
.menu-section .accordion.active, .menu-section .accordion:hover { background-color:#e64500; }
.menu-section .panel { padding:0 10px; max-height:0; overflow:hidden; transition:max-height 0.3s ease-in-out; background-color:#e64500; display:flex; flex-direction:column; gap:4px; }
.menu-section .panel button { background:transparent; color:white; border:none; padding:8px; text-align:left; display:flex; align-items:center; gap:6px; cursor:pointer; width:100%; border-radius:4px; }
.menu-section .panel button:hover { background-color:#cc4000; }
.sidebar.collapsed .brand span, .sidebar.collapsed .accordion span, .sidebar.collapsed .panel button span { display:none; }
.sidebar.collapsed .accordion { justify-content:center; }
.sidebar.collapsed .accordion i.fa-chevron-down { display:none; }
.main { margin-left:260px; padding:20px; transition:0.3s; }
.sidebar.collapsed ~ .main { margin-left:60px; }
.cards { display:flex; gap:20px; margin-top:20px; flex-wrap:wrap; }
.card { flex:1; min-width:150px; background:white; color:#ff4d00; padding:20px; border-radius:12px; text-align:center; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.1); transition:0.2s; }
.card:hover { transform:translateY(-3px); box-shadow:0 6px 12px rgba(0,0,0,0.15); }
.card span { font-weight:700; font-size:1.3rem; display:block; margin-top:5px;}
.card i { font-size:2rem; }
.search-bar { margin-bottom:15px; display:flex; gap:10px; }
.search-bar input { flex-grow:1; padding:10px; border-radius:6px; border:1px solid #ccc; font-size:1rem; }
table { width:100%; border-collapse:collapse; margin-top:20px; background:white; box-shadow:0 2px 4px rgba(0,0,0,0.05); display:block; overflow-x:auto; white-space:nowrap; }
th, td { border:1px solid #eee; padding:10px; text-align:center; font-size:0.9rem; }
th { background:#ff4d00; color:white; font-weight:600; }
tr:nth-child(even) { background-color:#f9f9f9; }
.actions button { margin:0 2px; padding:6px; border-radius:50%; border:none; cursor:pointer; width:32px; height:32px; transition:0.1s; }
.actions button:hover { opacity:0.8; }
.btn-edit { background:#ffb86b; color:white; }
.btn-del { background:#d9534f; color:white; }
.modal-backdrop { position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index:50; }
.modal { background:white; padding:25px; border-radius:12px; width:450px; max-width:95%; box-shadow:0 10px 20px rgba(0,0,0,0.2); }
input, select { padding:10px; border-radius:6px; border:1px solid #ccc; width:100%; margin-bottom:12px; font-size:1rem; }
.modal button { padding:8px 15px; border-radius:6px; cursor:pointer; border:none; font-weight:600; transition:0.1s; }
.modal button:last-child { background:#ff4d00; color:white; }
.modal button:last-child:hover { background:#cc3c00; }
.modal button:first-child { background:#eee; color:#333; margin-right:10px; }
.modal button:first-child:hover { background:#ddd; }
@media(max-width:768px){.cards{flex-direction:column;}.card{min-width:100%;}.sidebar{left:-260px;position:fixed;}.sidebar.collapsed{left:0;}.main{margin-left:0;padding:10px;}}
</style>
</head>
<body>
<div class="sidebar">
  <div class="brand">
    <span>Inventario 3A</span>
    <button id="toggleSidebar"><i class="fas fa-bars"></i></button>
  </div>
  <div class="menu-section">
    <button class="accordion"><i class="fas fa-store"></i><span>Tiendas</span><i class="fas fa-chevron-down"></i></button>
    <div class="panel">
      <button onclick="openModal('tienda')"><i class="fas fa-plus"></i><span>Agregar Tienda</span></button>
    </div>

    <button class="accordion"><i class="fas fa-tags"></i><span>CategorÃ­as</span><i class="fas fa-chevron-down"></i></button>
    <div class="panel">
      <button onclick="openModal('categoria')"><i class="fas fa-plus"></i><span>Agregar CategorÃ­a</span></button>
    </div>

    <button class="accordion"><i class="fas fa-box"></i><span>Inventario</span><i class="fas fa-chevron-down"></i></button>
    <div class="panel">
      <button onclick="openModal('inventario')"><i class="fas fa-plus"></i><span>Agregar Inventario</span></button>
    </div>
  </div>
</div>

<div class="main">
  <div class="cards">
    <div class="card" onclick="showTable('tienda')"><i class="fas fa-store"></i><span>Tiendas</span></div>
    <div class="card" onclick="showTable('categoria')"><i class="fas fa-tags"></i><span>CategorÃ­as</span></div>
    <div class="card" onclick="showTable('inventario')"><i class="fas fa-box"></i><span>Inventario</span></div>
  </div>

  <div id="tableContainer"></div>
</div>

<!-- Modal -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal">
    <h3 id="modalTitle"></h3>
    <form id="modalForm"></form>
    <div style="text-align:right;">
      <button type="button" onclick="closeModal()">Cancelar</button>
      <button type="submit" form="modalForm">Guardar</button>
    </div>
  </div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec"; // ðŸ‘ˆ Reemplazar con tu URL WebApp
let currentSheet = "";

// Abrir modal dinÃ¡mico
function openModal(sheet) {
  currentSheet = sheet;
  const modal = document.getElementById("modalBackdrop");
  modal.style.display = "flex";
  const form = document.getElementById("modalForm");
  form.innerHTML = "";

  if (sheet === "tienda") {
    document.getElementById("modalTitle").innerText = "Agregar Tienda";
    form.innerHTML += `<input type="text" name="codigo" placeholder="CÃ³digo" required>`;
    form.innerHTML += `<input type="text" name="nombre" placeholder="Nombre" required>`;
  }
  if (sheet === "categoria") {
    document.getElementById("modalTitle").innerText = "Agregar CategorÃ­a";
    form.innerHTML += `<input type="text" name="nombre" placeholder="Nombre de CategorÃ­a" required>`;
  }
  if (sheet === "inventario") {
    document.getElementById("modalTitle").innerText = "Agregar Inventario";
    form.innerHTML += `<input type="text" name="producto" placeholder="Producto" required>`;
    form.innerHTML += `<input type="number" name="cantidad" placeholder="Cantidad" required>`;
  }
}
function closeModal(){ document.getElementById("modalBackdrop").style.display="none"; }

// Enviar datos
document.getElementById("modalForm").addEventListener("submit", async function(e){
  e.preventDefault();
  const formData = new FormData(e.target);
  formData.append("sheet", currentSheet);
  formData.append("action", "add");
  const res = await fetch(scriptURL, { method:"POST", body:new URLSearchParams(formData)});
  const result = await res.json();
  if(result.success){ closeModal(); showTable(currentSheet); }
  else{ alert("Error: " + result.msg); }
});

// Mostrar tabla
async function showTable(sheet){
  currentSheet = sheet;
  const res = await fetch(`${scriptURL}?sheet=${sheet}&action=get&t=${Date.now()}`);
  const data = await res.json();
  let html = `<h2>${sheet.charAt(0).toUpperCase()+sheet.slice(1)}</h2>`;
  html += `<div class="search-bar"><input type="text" placeholder="Buscar..." onkeyup="searchTable(this.value)"></div>`;
  html += `<table><thead><tr>`;

  if(sheet === "tienda"){
    html += "<th>CÃ³digo</th><th>Nombre</th>";
  } else if(sheet === "categoria"){
    html += "<th>Nombre</th>";
  } else if(sheet === "inventario"){
    html += "<th>Producto</th><th>Cantidad</th>";
  }
  html += "<th>Acciones</th></tr></thead><tbody>";

  data.forEach(row=>{
    html += "<tr>";
    if(sheet === "tienda"){
      html += `<td>${row.codigo || ""}</td><td>${row.nombre || ""}</td>`;
    } else if(sheet === "categoria"){
      html += `<td>${row.nombre || ""}</td>`;
    } else if(sheet === "inventario"){
      html += `<td>${row.producto || ""}</td><td>${row.cantidad || ""}</td>`;
    }
    html += `<td class="actions"><button class="btn-del" onclick="deleteRow('${sheet}','${row.codigo || row.id}')"><i class="fas fa-trash"></i></button></td>`;
    html += "</tr>";
  });

  html += "</tbody></table>";
  document.getElementById("tableContainer").innerHTML = html;
}

// Eliminar fila
async function deleteRow(sheet,idValue){
  if(!confirm("Â¿Eliminar registro?")) return;
  const formData = new URLSearchParams();
  formData.append("sheet", sheet);
  formData.append("action", "delete");
  formData.append("idValue", idValue);
  const res = await fetch(scriptURL,{method:"POST",body:formData});
  const result = await res.json();
  if(result.success){ showTable(sheet); }
  else{ alert("Error: "+result.msg); }
}

// Buscar en tabla
function searchTable(query){
  const rows = document.querySelectorAll("#tableContainer table tbody tr");
  rows.forEach(r=>{
    r.style.display = r.innerText.toLowerCase().includes(query.toLowerCase())?"":"none";
  });
}
</script>
</body>
</html>
