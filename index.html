<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Inventario Tiendas 3A</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
      overflow: hidden;
    }
    /* Sidebar */
    #sidebar {
      width: 220px;
      background: #ff6600;
      color: white;
      display: flex;
      flex-direction: column;
      transition: width 0.3s;
    }
    #sidebar.collapsed { width: 70px; }
    #sidebar h2 {
      text-align: center;
      padding: 15px 10px;
      margin: 0;
      font-size: 1.2em;
    }
    #sidebar ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    #sidebar li {
      padding: 15px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: background 0.3s;
    }
    #sidebar li:hover { background: #e65c00; }
    #sidebar i {
      margin-right: 10px;
      min-width: 20px;
      text-align: center;
    }
    #sidebar.collapsed i { margin-right: 0; }
    #sidebar.collapsed span { display: none; }
    /* Main */
    #main {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow-y: auto;
      padding: 20px;
      background: #f4f6f9;
    }
    /* Cards */
    .cards {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .card {
      flex: 1;
      min-width: 150px;
      background: white;
      border-radius: 10px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      cursor: pointer;
      transition: transform 0.2s;
    }
    .card:hover { transform: scale(1.05); }
    .card i {
      font-size: 2em;
      margin-bottom: 10px;
      color: #ff6600;
    }
    .card span { font-weight: bold; display:block; }
    .card small { color: gray; display:block; margin-top:5px; }
    /* Tables */
    table {
      width: 100%;
      border-collapse: collapse;
      background: white;
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: left;
    }
    th { background: #ff6600; color: white; }
    tr:nth-child(even) { background: #f9f9f9; }
    /* Buttons */
    button {
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 2px;
    }
    .btn-add { background: #28a745; color: white; }
    .btn-edit { background: #007bff; color: white; }
    .btn-del { background: #dc3545; color: white; }
    /* Forms */
    form {
      display: flex;
      flex-direction: column;
      gap: 10px;
      background: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
    }
    input, select {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 5px;
    }
    @media(max-width:768px){
      .cards { flex-direction: column; }
      #sidebar { position: fixed; height: 100%; z-index: 100; }
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <h2>3A</h2>
    <ul>
      <li onclick="nav('dashboard')"><i class="fa-solid fa-chart-line"></i><span>Dashboard</span></li>
      <li onclick="nav('inventario')"><i class="fa-solid fa-computer"></i><span>Inventario</span></li>
      <li onclick="nav('categorias')"><i class="fa-solid fa-tags"></i><span>Categorías</span></li>
      <li onclick="nav('tiendas')"><i class="fa-solid fa-store"></i><span>Tiendas</span></li>
      <li onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i><span>Colapsar</span></li>
    </ul>
  </div>
  <div id="main">
    <div id="main-content"></div>
  </div>

<script>
const apiUrl = "https://script.google.com/macros/s/AKfycbz5af-9YvEbD_2Lkwss6xPhBXqh9UEaqMqHIQ1OdXrv44SSxsYYa47Z5x4e6LFyPHFN/exec";
let view="dashboard";
let inventario=[], categorias=[], tiendas=[];

/* Sidebar toggle */
function toggleSidebar(){
  document.getElementById("sidebar").classList.toggle("collapsed");
}

/* Navegación */
function nav(v){ view=v; render(); }

/* Fetch GET */
async function fetchData(sheet){
  let res=await fetch(`${apiUrl}?sheet=${sheet}&action=get`);
  return await res.json();
}

/* Fetch ADD/UPDATE/DELETE */
async function sendData(params){
  let url = apiUrl+"?"+new URLSearchParams(params).toString();
  let res=await fetch(url);
  return await res.json();
}

/* Cargar datos iniciales */
async function loadAll(){
  inventario = await fetchData("Inventario");
  categorias = await fetchData("Categorias");
  tiendas = await fetchData("Tiendas");
  render();
}

/* Render principal */
function render(){
  let main=document.getElementById('main-content');
  main.innerHTML='';

  if(view==='dashboard'){
    main.innerHTML=`
      <h3>Dashboard</h3>
      <div class="cards">
        <div class="card" onclick="nav('inventario')">
          <i class="fa-solid fa-computer"></i>
          <span>Inventario</span>
          <small>${inventario.length} registros</small>
        </div>
        <div class="card" onclick="nav('categorias')">
          <i class="fa-solid fa-tags"></i>
          <span>Categorías</span>
          <small>${categorias.length} registros</small>
        </div>
        <div class="card" onclick="nav('tiendas')">
          <i class="fa-solid fa-store"></i>
          <span>Tiendas</span>
          <small>${tiendas.length} registros</small>
        </div>
      </div>`;
  }
  else if(view==='inventario'){ renderInventario(); }
  else if(view==='categorias'){ renderCategorias(); }
  else if(view==='tiendas'){ renderTiendas(); }
}

/* Render Inventario */
function renderInventario(){
  let main=document.getElementById('main-content');
  main.innerHTML=`
    <h3>Inventario</h3>
    <form id="formInv">
      <input name="Codigo" placeholder="Código" required>
      <input name="Serie" placeholder="Serie" required>
      <input name="Equipo" placeholder="Equipo" required>
      <input name="Marca" placeholder="Marca" required>
      <input name="Modelo" placeholder="Modelo" required>
      <select name="Categoria">${categorias.map(c=>`<option>${c.Nombre||c}</option>`).join('')}</select>
      <select name="Tienda">${tiendas.map(t=>`<option>${t.Nombre||t}</option>`).join('')}</select>
      <button class="btn-add">Agregar</button>
    </form>
    <table>
      <thead><tr><th>Código</th><th>Serie</th><th>Equipo</th><th>Marca</th><th>Modelo</th><th>Categoría</th><th>Tienda</th><th>Acciones</th></tr></thead>
      <tbody>
        ${inventario.map(r=>`
          <tr>
            <td>${r.Codigo}</td>
            <td>${r.Serie}</td>
            <td>${r.Equipo}</td>
            <td>${r.Marca}</td>
            <td>${r.Modelo}</td>
            <td>${r.Categoria}</td>
            <td>${r.Tienda}</td>
            <td>
              <button class="btn-edit" onclick="editInv('${r.Codigo}')">Editar</button>
              <button class="btn-del" onclick="delInv('${r.Codigo}')">Eliminar</button>
            </td>
          </tr>`).join('')}
      </tbody>
    </table>`;
  document.getElementById("formInv").onsubmit=addInv;
}

/* Inventario CRUD */
async function addInv(e){
  e.preventDefault();
  let fd=new FormData(e.target);
  let params={sheet:"Inventario",action:"add"};
  fd.forEach((v,k)=>params[k]=v);
  await sendData(params);
  inventario=await fetchData("Inventario");
  renderInventario();
}
async function delInv(codigo){
  await sendData({sheet:"Inventario",action:"delete",idCol:"Codigo",idValue:codigo});
  inventario=await fetchData("Inventario");
  renderInventario();
}
function editInv(codigo){
  let r=inventario.find(x=>x.Codigo===codigo);
  if(!r) return;
  let form=document.getElementById("formInv");
  Object.keys(r).forEach(k=>{
    if(form[k]) form[k].value=r[k];
  });
  form.onsubmit=async function(ev){
    ev.preventDefault();
    let fd=new FormData(form);
    let params={sheet:"Inventario",action:"update",idCol:"Codigo",idValue:codigo};
    fd.forEach((v,k)=>params[k]=v);
    await sendData(params);
    inventario=await fetchData("Inventario");
    renderInventario();
  }
}

/* Render Categorías */
function renderCategorias(){
  let main=document.getElementById('main-content');
  main.innerHTML=`
    <h3>Categorías</h3>
    <form id="formCat">
      <input name="Nombre" placeholder="Nombre de categoría" required>
      <button class="btn-add">Agregar</button>
    </form>
    <table>
      <thead><tr><th>Nombre</th><th>Acciones</th></tr></thead>
      <tbody>
        ${categorias.map(r=>`
          <tr>
            <td>${r.Nombre||r}</td>
            <td>
              <button class="btn-edit" onclick="editCat('${r.Nombre||r}')">Editar</button>
              <button class="btn-del" onclick="delCat('${r.Nombre||r}')">Eliminar</button>
            </td>
          </tr>`).join('')}
      </tbody>
    </table>`;
  document.getElementById("formCat").onsubmit=addCat;
}

/* Categorías CRUD */
async function addCat(e){
  e.preventDefault();
  let fd=new FormData(e.target);
  let params={sheet:"Categorias",action:"add"};
  fd.forEach((v,k)=>params[k]=v);
  await sendData(params);
  categorias=await fetchData("Categorias");
  renderCategorias();
}
async function delCat(nombre){
  await sendData({sheet:"Categorias",action:"delete",idCol:"Nombre",idValue:nombre});
  categorias=await fetchData("Categorias");
  renderCategorias();
}
function editCat(nombre){
  let r=categorias.find(x=>(x.Nombre||x)===nombre);
  let form=document.getElementById("formCat");
  form.Nombre.value=r.Nombre||r;
  form.onsubmit=async function(ev){
    ev.preventDefault();
    let fd=new FormData(form);
    let params={sheet:"Categorias",action:"update",idCol:"Nombre",idValue:nombre};
    fd.forEach((v,k)=>params[k]=v);
    await sendData(params);
    categorias=await fetchData("Categorias");
    renderCategorias();
  }
}

/* Render Tiendas */
function renderTiendas(){
  let main=document.getElementById('main-content');
  main.innerHTML=`
    <h3>Tiendas</h3>
    <form id="formTda">
      <input name="Nombre" placeholder="Nombre de tienda" required>
      <button class="btn-add">Agregar</button>
    </form>
    <table>
      <thead><tr><th>Nombre</th><th>Acciones</th></tr></thead>
      <tbody>
        ${tiendas.map(r=>`
          <tr>
            <td>${r.Nombre||r}</td>
            <td>
              <button class="btn-edit" onclick="editTda('${r.Nombre||r}')">Editar</button>
              <button class="btn-del" onclick="delTda('${r.Nombre||r}')">Eliminar</button>
            </td>
          </tr>`).join('')}
      </tbody>
    </table>`;
  document.getElementById("formTda").onsubmit=addTda;
}

/* Tiendas CRUD */
async function addTda(e){
  e.preventDefault();
  let fd=new FormData(e.target);
  let params={sheet:"Tiendas",action:"add"};
  fd.forEach((v,k)=>params[k]=v);
  await sendData(params);
  tiendas=await fetchData("Tiendas");
  renderTiendas();
}
async function delTda(nombre){
  await sendData({sheet:"Tiendas",action:"delete",idCol:"Nombre",idValue:nombre});
  tiendas=await fetchData("Tiendas");
  renderTiendas();
}
function editTda(nombre){
  let r=tiendas.find(x=>(x.Nombre||x)===nombre);
  let form=document.getElementById("formTda");
  form.Nombre.value=r.Nombre||r;
  form.onsubmit=async function(ev){
    ev.preventDefault();
    let fd=new FormData(form);
    let params={sheet:"Tiendas",action:"update",idCol:"Nombre",idValue:nombre};
    fd.forEach((v,k)=>params[k]=v);
    await sendData(params);
    tiendas=await fetchData("Tiendas");
    renderTiendas();
  }
}

/* Iniciar */
loadAll();
</script>
</body>
</html>
