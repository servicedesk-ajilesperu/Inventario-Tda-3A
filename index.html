<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario Tiendas 3A</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
/* === ESTILOS === */
body, html { margin:0; padding:0; font-family:sans-serif; background:#f7f7f7; }
* { box-sizing:border-box; }
.sidebar { width: 260px; position:fixed; height:100%; background:#ff4d00; color:white; display:flex; flex-direction:column; gap:12px; padding:20px; transition:0.3s; overflow-y:auto; z-index:10; }
.sidebar.collapsed { width:60px; padding:20px 5px; }
.brand { display:flex; align-items:center; gap:10px; font-weight:700; font-size:1.2rem; position:relative; margin-bottom:10px; }
#toggleSidebar { position:absolute; right:0; top:0; background:#cc3c00; color:white; border:none; border-radius:6px; padding:4px 8px; cursor:pointer; }
.menu-section .accordion { background:transparent; color:white; border:none; padding:10px; width:100%; display:flex; align-items:center; gap:10px; cursor:pointer; font-weight:600; justify-content:space-between; border-radius:4px; }
.menu-section .accordion.active, .menu-section .accordion:hover { background-color:#e64500; }
.menu-section .panel { padding:0 10px; max-height:0; overflow:hidden; transition:max-height 0.3s ease-in-out; background-color:#e64500; display:flex; flex-direction:column; gap:4px; }
.menu-section .panel button { background:transparent; color:white; border:none; padding:8px; text-align:left; display:flex; align-items:center; gap:6px; cursor:pointer; width:100%; border-radius:4px; }
.menu-section .panel button:hover { background-color:#cc4000; }
.sidebar.collapsed .brand span, .sidebar.collapsed .accordion span, .sidebar.collapsed .panel button span { display:none; }
.sidebar.collapsed .accordion { justify-content:center; }
.sidebar.collapsed .accordion i.fa-chevron-down { display:none; }
.main { margin-left:260px; padding:20px; transition:0.3s; }
.sidebar.collapsed ~ .main { margin-left:60px; }
.cards { display:flex; gap:20px; margin-top:20px; flex-wrap:wrap; }
.card { flex:1; min-width:150px; background:white; color:#ff4d00; padding:20px; border-radius:12px; text-align:center; cursor:pointer; box-shadow:0 4px 8px rgba(0,0,0,0.1); transition:0.2s; }
.card:hover { transform:translateY(-3px); box-shadow:0 6px 12px rgba(0,0,0,0.15); }
.card span { font-weight:700; font-size:1.3rem; display:block; margin-top:5px; }
.card i { font-size:2rem; }
.search-bar { margin-bottom:15px; display:flex; gap:10px; }
.search-bar input { flex-grow:1; padding:10px; border-radius:6px; border:1px solid #ccc; font-size:1rem; }
table { width:100%; border-collapse:collapse; margin-top:20px; background:white; box-shadow:0 2px 4px rgba(0,0,0,0.05); display:block; overflow-x:auto; white-space:nowrap; }
th, td { border:1px solid #eee; padding:10px; text-align:center; font-size:0.9rem; }
th { background:#ff4d00; color:white; font-weight:600; }
tr:nth-child(even) { background-color:#f9f9f9; }
.actions button { margin:0 2px; padding:6px; border-radius:50%; border:none; cursor:pointer; width:32px; height:32px; transition:0.1s; }
.actions button:hover { opacity:0.8; }
.btn-edit { background:#ffb86b; color:white; }
.btn-del { background:#d9534f; color:white; }
@media(max-width:768px){
  .cards { flex-direction:column; }
  .card { min-width:100%; }
  .sidebar { left:-260px; position:fixed; }
  .sidebar.collapsed { left:0; }
  .main { margin-left:0; padding:10px; }
}
</style>
</head>
<body>

<!-- === MENU LATERAL === -->
<aside class="sidebar" id="sidebar">
  <div class="brand">
    <i class="fa-solid fa-boxes-stacked"></i> <span>Inventario 3A</span>
    <button id="toggleSidebar"><i class="fa-solid fa-bars"></i></button>
  </div>
  <div class="menu-section">
    <button class="accordion">Menú <i class="fa-solid fa-chevron-down"></i></button>
    <div class="panel">
      <button onclick="renderDashboard()"><i class="fa-solid fa-gauge"></i> <span>Dashboard</span></button>
      <button onclick="nav('inventario')"><i class="fa-solid fa-computer"></i> <span>Inventario</span></button>
      <button onclick="nav('categoria')"><i class="fa-solid fa-tags"></i> <span>Categorías</span></button>
      <button onclick="nav('tienda')"><i class="fa-solid fa-store"></i> <span>Tiendas</span></button>
    </div>
  </div>
</aside>

<!-- === CONTENIDO PRINCIPAL === -->
<div class="main">
  <h2 id="main-title">Dashboard</h2>
  <div class="cards" id="dashboard-cards"></div>
  <div id="content"></div>
</div>

<script>
const APP_SCRIPT_URL = "https://script.google.com/macros/s/YOUR_DEPLOY_CODE/exec";
let dataStore = { inventario:[], categoria:[], tienda:[] };
let currentSheet = "";

// === Fetch inicial ===
async function fetchSheet(sheet){
  try{
    const res = await fetch(`${APP_SCRIPT_URL}?sheet=${sheet}&action=read`);
    const json = await res.json();
    if(json.success){
      dataStore[sheet] = json.data;
      return json.data;
    }
    return [];
  }catch(e){ console.error(e); return []; }
}

// === Render tabla usando dataStore (rápido) ===
function renderTable(sheet){
  currentSheet = sheet;
  document.getElementById("dashboard-cards").innerHTML = "";
  document.getElementById("main-title").textContent = sheet.charAt(0).toUpperCase()+sheet.slice(1);

  let data = dataStore[sheet] || [];
  let html = `<div class="search-bar"><input type="text" placeholder="Buscar..." oninput="filterTable(this.value)"></div>`;
  if(data.length>0){
    html += `<table><thead><tr>`;
    Object.keys(data[0]).forEach(h=>{
      if((sheet==="inventario" || sheet==="categoria") && h==="id") return;
      if(sheet==="tienda" && !(h==="codigo" || h==="nombre")) return;
      html+=`<th>${h}</th>`;
    });
    html+=`<th>Acciones</th></tr></thead><tbody>`;
    data.forEach((r,i)=>{
      html+=`<tr>`;
      Object.entries(r).forEach(([k,v])=>{
        if((sheet==="inventario" || sheet==="categoria") && k==="id") return;
        if(sheet==="tienda" && !(k==="codigo" || k==="nombre")) return;
        html+=`<td>${v}</td>`;
      });
      html+=`<td class="actions">
        <button class="btn-edit"><i class="fa-solid fa-pen"></i></button>
        <button class="btn-del"><i class="fa-solid fa-trash"></i></button>
      </td></tr>`;
    });
    html+=`</tbody></table>`;
  } else html+=`<table><tr><td>No hay datos</td></tr></table>`;
  document.getElementById("content").innerHTML = html;
}

// === Dashboard ===
function renderDashboard(){
  const cardsDiv=document.getElementById("dashboard-cards");
  cardsDiv.innerHTML="";
  cardsDiv.innerHTML+=`<div class="card" onclick="nav('inventario')"><i class="fa-solid fa-computer"></i><span>${dataStore.inventario.length}</span>Inventario</div>`;
  cardsDiv.innerHTML+=`<div class="card" onclick="nav('categoria')"><i class="fa-solid fa-tags"></i><span>${dataStore.categoria.length}</span>Categorías</div>`;
  cardsDiv.innerHTML+=`<div class="card" onclick="nav('tienda')"><i class="fa-solid fa-store"></i><span>${dataStore.tienda.length}</span>Tiendas</div>`;
  document.getElementById("content").innerHTML="";
  document.getElementById("main-title").textContent="Dashboard";
}

// === Buscar ===
function filterTable(value){
  const tbody=document.querySelector("tbody");
  if(!tbody) return;
  Array.from(tbody.rows).forEach(r=>{
    r.style.display = Array.from(r.cells).some(c=>c.textContent.toLowerCase().includes(value.toLowerCase())) ? "" : "none";
  });
}

// === Navegación ===
function nav(sheet){ renderTable(sheet); }

// === Init ===
Promise.all([fetchSheet("inventario"),fetchSheet("categoria"),fetchSheet("tienda")])
  .then(()=>renderDashboard());

// === Sidebar ===
document.querySelectorAll('.accordion').forEach(acc=>{
  acc.addEventListener('click',function(){
    this.classList.toggle('active');
    let panel=this.nextElementSibling;
    panel.style.maxHeight = panel.style.maxHeight ? null : panel.scrollHeight+"px";
  });
});
document.getElementById("toggleSidebar").addEventListener("click",()=>{ 
  document.getElementById("sidebar").classList.toggle("collapsed"); 
});
</script>
</body>
</html>
