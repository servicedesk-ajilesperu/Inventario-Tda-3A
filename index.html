<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario Tiendas 3A</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:sans-serif;}
body,html{height:100%;width:100%;}

#app{display:flex;height:100vh;width:100vw;}
/* Sidebar */
.sidebar{width:240px;transition:0.3s;position:fixed;height:100%;background:#0f62fe;color:white;display:flex;flex-direction:column;gap:12px;padding:20px;}
.sidebar.collapsed{width:60px;padding:20px 5px;}
.brand{display:flex;align-items:center;gap:10px;font-weight:700;font-size:1.15rem;position:relative;}
#toggleSidebar{position:absolute;right:10px;top:10px;background:#0f62fe;color:white;border:none;border-radius:6px;padding:4px 8px;cursor:pointer;z-index:1000;}
.menu-section button{background:transparent;color:white;border:none;padding:10px;width:100%;cursor:pointer;font-weight:600;display:flex;align-items:center;gap:10px;border-radius:8px;transition:0.2s;}
.menu-section button:hover{background:rgba(255,255,255,0.15);}
.sidebar.collapsed span{display:none;}

/* Main */
.main{flex:1;margin-left:240px;transition:0.3s;display:flex;flex-direction:column;height:100vh;}
.sidebar.collapsed ~ .main{margin-left:60px;}
header.appbar{height:64px;background:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 22px;box-shadow:0 2px 8px rgba(15,98,254,0.06);}
.app-title{font-weight:700;color:#0f62fe;}
.counter{background:#eef;padding:8px 12px;border-radius:999px;font-weight:600;}

.content{padding:20px;height:calc(100vh - 64px);overflow:auto;}
.cards{display:flex;gap:20px;flex-wrap:wrap;}
.card{flex:1;min-width:150px;background:white;padding:15px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.08);text-align:center;cursor:pointer;}
.card span{font-weight:700;font-size:1.2rem;}
.card i{font-size:24px;color:#0f62fe;margin-bottom:8px;}

table{width:100%;border-collapse:collapse;font-size:0.95rem;margin-top:10px;}
thead th{background:#ff4d00;color:#fff;padding:10px;text-align:center;}
tbody td{padding:8px;border-bottom:1px solid #eee;text-align:center;}
.actions button{margin:0 2px;padding:6px;border-radius:6px;border:none;cursor:pointer;}
.btn-edit{background:#ffa500;color:white;}
.btn-del{background:#ff3b3b;color:white;}

.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;z-index:50;}
.modal{background:white;padding:20px;border-radius:12px;width:400px;max-width:95%;}
.modal input, .modal select{width:100%;margin-bottom:10px;padding:8px;border:1px solid #ccc;border-radius:6px;}
.modal .btn-save{background:#0f62fe;color:white;padding:8px 12px;border:none;border-radius:6px;cursor:pointer;}
.modal .btn-cancel{background:#ccc;padding:8px 12px;border:none;border-radius:6px;cursor:pointer;}
</style>
</head>
<body>

<div id="app">
  <aside class="sidebar">
    <div class="brand">
      <i class="fa-solid fa-boxes-stacked"></i><span>Inventario</span>
      <button id="toggleSidebar"><i class="fa-solid fa-bars"></i></button>
    </div>
    <div class="menu-section">
      <button onclick="nav('dashboard')"><i class="fa-solid fa-house"></i><span>Dashboard</span></button>
    </div>
    <div class="menu-section">
      <button onclick="nav('inventario')"><i class="fa-solid fa-computer"></i><span>Inventario</span></button>
      <button onclick="openModal('equipo')"><i class="fa-solid fa-plus"></i><span>Agregar equipo</span></button>
    </div>
    <div class="menu-section">
      <button onclick="nav('categorias')"><i class="fa-solid fa-tags"></i><span>Categorías</span></button>
      <button onclick="openModal('categoria')"><i class="fa-solid fa-plus"></i><span>Agregar categoría</span></button>
    </div>
    <div class="menu-section">
      <button onclick="nav('tiendas')"><i class="fa-solid fa-store"></i><span>Tiendas</span></button>
      <button onclick="openModal('tienda')"><i class="fa-solid fa-plus"></i><span>Agregar tienda</span></button>
    </div>
  </aside>

  <div class="main">
    <header class="appbar">
      <div class="app-title">Inventario Tiendas 3A</div>
      <div class="counter" id="header-counter">Total: 0</div>
    </header>
    <main class="content" id="main-content"></main>
  </div>
</div>

<!-- Modal Formulario -->
<div class="modal-backdrop" id="modal">
  <div class="modal">
    <h3 id="modalTitle"></h3>
    <div id="modalFields"></div>
    <div style="text-align:right;">
      <button class="btn-cancel" onclick="closeModal()">Cancelar</button>
      <button class="btn-save" onclick="saveModal()">Guardar</button>
    </div>
  </div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbz5af-9YvEbD_2Lkwss6xPhBXqh9UEaqMqHIQ1OdXrv44SSxsYYa47Z5x4e6LFyPHFN/exec";
let state = { view:"dashboard" };
let inventario=[], categorias=[], tiendas=[];
let currentForm="", editIdx=null;

document.getElementById("toggleSidebar").onclick=()=>document.querySelector(".sidebar").classList.toggle("collapsed");

// Inicial
fetchData("Inventario", d=>{inventario=d; render();});
fetchData("Categorias", d=>{categorias=d.map(x=>x.Nombre); render();});
fetchData("Tiendas", d=>{tiendas=d.map(x=>x.Nombre); render();});

function nav(v){ state.view=v; render(); }

function fetchData(sheet, cb){
  fetch(`${scriptURL}?sheet=${sheet}&action=get`).then(r=>r.json()).then(cb);
}

function render(){
  const main=document.getElementById("main-content");
  main.innerHTML="";
  if(state.view==="dashboard"){
    main.innerHTML=`<h3>Dashboard</h3>
    <div class="cards">
      <div class="card"><i class="fa-solid fa-computer"></i><span>Equipos: ${inventario.length}</span></div>
      <div class="card"><i class="fa-solid fa-tags"></i><span>Categorías: ${categorias.length}</span></div>
      <div class="card"><i class="fa-solid fa-store"></i><span>Tiendas: ${tiendas.length}</span></div>
    </div>`;
  }
  if(state.view==="inventario"){ renderTable("Inventario",inventario); }
  if(state.view==="categorias"){ renderTable("Categorias",categorias.map((c,i)=>({ID:i+1,Nombre:c}))); }
  if(state.view==="tiendas"){ renderTable("Tiendas",tiendas.map((t,i)=>({ID:i+1,Nombre:t}))); }
  document.getElementById("header-counter").innerText="Total: "+inventario.length;
}

function renderTable(title,data){
  const main=document.getElementById("main-content");
  if(data.length===0){main.innerHTML=`<p>No hay datos en ${title}.</p>`;return;}
  let headers=Object.keys(data[0]);
  let table=`<h3>${title}</h3><table><thead><tr>${headers.map(h=>`<th>${h}</th>`).join("")}<th>Acciones</th></tr></thead><tbody>`;
  data.forEach((row,i)=>{
    table+=`<tr>${headers.map(h=>`<td>${row[h]}</td>`).join("")}
      <td class="actions">
        <button class="btn-edit" onclick="editItem('${title}',${i})"><i class="fa-solid fa-pen"></i></button>
        <button class="btn-del" onclick="deleteItem('${title}',${i})"><i class="fa-solid fa-trash"></i></button>
      </td></tr>`;
  });
  table+="</tbody></table>";
  main.innerHTML=table;
}

// --- Formularios ---
function openModal(type,idx=null){
  currentForm=type; editIdx=idx;
  document.getElementById("modal").style.display="flex";
  let fields="";
  if(type==="equipo"){
    const e= idx!==null ? inventario[idx]:{};
    fields=`<input id="f_codigo" placeholder="Código" value="${e.Codigo||""}">
    <input id="f_serie" placeholder="Serie" value="${e.Serie||""}">
    <input id="f_equipo" placeholder="Equipo" value="${e.Equipo||""}">
    <input id="f_marca" placeholder="Marca" value="${e.Marca||""}">
    <input id="f_modelo" placeholder="Modelo" value="${e.Modelo||""}">
    <select id="f_categoria">${categorias.map(c=>`<option ${c==e.Categoria?"selected":""}>${c}</option>`)}</select>
    <select id="f_tienda">${tiendas.map(t=>`<option ${t==e.Tienda?"selected":""}>${t}</option>`)}</select>`;
    document.getElementById("modalTitle").innerText= idx!==null?"Editar Equipo":"Agregar Equipo";
  }
  if(type==="categoria"){
    const c= idx!==null ? categorias[idx]:"";
    fields=`<input id="f_nombre" placeholder="Nombre categoría" value="${c}">`;
    document.getElementById("modalTitle").innerText= idx!==null?"Editar Categoría":"Agregar Categoría";
  }
  if(type==="tienda"){
    const t= idx!==null ? tiendas[idx]:"";
    fields=`<input id="f_nombre" placeholder="Nombre tienda" value="${t}">`;
    document.getElementById("modalTitle").innerText= idx!==null?"Editar Tienda":"Agregar Tienda";
  }
  document.getElementById("modalFields").innerHTML=fields;
}
function closeModal(){document.getElementById("modal").style.display="none";}

function saveModal(){
  if(currentForm==="equipo"){
    const obj={
      Codigo:document.getElementById("f_codigo").value,
      Serie:document.getElementById("f_serie").value,
      Equipo:document.getElementById("f_equipo").value,
      Marca:document.getElementById("f_marca").value,
      Modelo:document.getElementById("f_modelo").value,
      Categoria:document.getElementById("f_categoria").value,
      Tienda:document.getElementById("f_tienda").value
    };
    if(editIdx!==null) inventario[editIdx]=obj; else inventario.push(obj);
    sync("Inventario",obj);
  }
  if(currentForm==="categoria"){
    const name=document.getElementById("f_nombre").value;
    if(editIdx!==null) categorias[editIdx]=name; else categorias.push(name);
    sync("Categorias",{Nombre:name});
  }
  if(currentForm==="tienda"){
    const name=document.getElementById("f_nombre").value;
    if(editIdx!==null) tiendas[editIdx]=name; else tiendas.push(name);
    sync("Tiendas",{Nombre:name});
  }
  closeModal(); render();
}

function editItem(sheet,i){ openModal(sheet.toLowerCase().slice(0,-1),i); }
function deleteItem(sheet,i){
  if(sheet==="Inventario"){inventario.splice(i,1);}
  if(sheet==="Categorias"){categorias.splice(i,1);}
  if(sheet==="Tiendas"){tiendas.splice(i,1);}
  render();
  // enviar delete a sheets si quieres
}

// --- Sincronización ---
function sync(sheet,obj){
  fetch(`${scriptURL}?sheet=${sheet}&action=add&`+new URLSearchParams(obj))
    .catch(()=>alert("Error sincronizando con Google Sheet"));
}
</script>
</body>
</html>
