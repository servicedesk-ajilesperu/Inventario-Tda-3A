<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario Tiendas 3A</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
<style>
:root {
  --primary: #ff4d00;
  --dark: #222;
  --light: #f9f9f9;
}
body {
  margin:0; font-family: Arial, sans-serif;
  background: var(--light); color: var(--dark);
  display:flex;
}
.sidebar {
  width:220px; background: var(--primary); color:#fff;
  min-height:100vh; padding:15px; position:fixed;
}
.sidebar h2 { text-align:center; margin:0 0 15px; }
.sidebar ul { list-style:none; padding:0; }
.sidebar ul li {
  padding:10px; cursor:pointer; border-radius:8px;
}
.sidebar ul li:hover { background:rgba(255,255,255,0.2); }
.content {
  margin-left:220px; padding:20px; flex:1;
}
h1 { margin-top:0; }
.cards {
  display:grid; grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
  gap:15px;
}
.card {
  background:#fff; padding:20px; border-radius:12px;
  box-shadow:0 2px 6px rgba(0,0,0,0.1); text-align:center;
  cursor:pointer; transition:.2s;
}
.card:hover { transform:translateY(-3px); }
.table-container { overflow-x:auto; }
table { width:100%; border-collapse:collapse; background:#fff; }
th, td { padding:10px; border:1px solid #ddd; text-align:left; }
button {
  background:var(--primary); color:#fff; border:none;
  padding:6px 12px; border-radius:6px; cursor:pointer;
}
button:hover { opacity:.8; }
.modal {
  display:none; position:fixed; top:0; left:0; right:0; bottom:0;
  background:rgba(0,0,0,0.5); justify-content:center; align-items:center;
}
.modal-content {
  background:#fff; padding:20px; border-radius:12px; width:90%; max-width:500px;
}
.modal-content input, .modal-content select {
  display:block; width:100%; padding:8px; margin-bottom:10px;
  border:1px solid #ccc; border-radius:6px;
}
</style>
</head>
<body>
<div class="sidebar">
  <h2>Inventario 3A</h2>
  <ul>
    <li onclick="nav('dashboard')"><i class="fa-solid fa-chart-line"></i> Dashboard</li>
    <li onclick="nav('inventario')"><i class="fa-solid fa-computer"></i> Inventario</li>
    <li onclick="nav('categoria')"><i class="fa-solid fa-tags"></i> Categorías</li>
    <li onclick="nav('tienda')"><i class="fa-solid fa-store"></i> Tiendas</li>
  </ul>
</div>

<div class="content">
  <h1 id="main-title">Dashboard de Inventario</h1>
  <div id="content"></div>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <h2 id="modal-title"></h2>
    <form id="modal-form"></form>
    <div style="text-align:right">
      <button type="button" onclick="closeModal()">Cancelar</button>
      <button type="button" onclick="saveForm()">Guardar</button>
    </div>
  </div>
</div>

<script>
/* ================= CONFIG ================= */
const APPWEB_URL = "https://script.google.com/macros/s/AKfycbz5af-9YvEbD_2Lkwss6xPhBXqh9UEaqMqHIQ1OdXrv44SSxsYYa47Z5x4e6LFyPHFN/exec";
let inventario = [], categorias = [], tiendas = [], pendingOps = [];
let editItemIndex = null;
let currentView = 'dashboard';
let currentSearch = '';
const STORAGE_KEY = 'inventario3a';
/* ========================================== */

function nav(view){ currentView=view; render(); }

/* Guardar/leer localStorage */
function saveData(){ localStorage.setItem(STORAGE_KEY, JSON.stringify({inventario,categorias,tiendas})); }
function loadData(){
  try{
    const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
    if(data){ inventario=data.inventario||[]; categorias=data.categorias||[]; tiendas=data.tiendas||[]; }
  }catch(e){ console.warn("loadData error", e); }
}

/* Render principal */
function render(){
  const container=document.getElementById('content');
  container.innerHTML='';
  const titleEl=document.getElementById('main-title');

  if(currentView==='dashboard'){
    titleEl.innerText='Dashboard de Inventario';
    const cards=document.createElement('div'); cards.className='cards';
    const createCard=(label,count,view,icon)=>{
      const c=document.createElement('div');
      c.className='card';
      c.innerHTML=`<i class="fa-solid ${icon}"></i><span>${label}: ${count}</span>`;
      c.onclick=()=>nav(view);
      return c;
    };
    cards.appendChild(createCard('Equipos',inventario.length,'inventario','fa-computer'));
    cards.appendChild(createCard('Categorías',categorias.length,'categoria','fa-tags'));
    cards.appendChild(createCard('Tiendas',tiendas.length,'tienda','fa-store'));
    container.appendChild(cards);
    return;
  }

  titleEl.innerText=currentView.charAt(0).toUpperCase()+currentView.slice(1);
  const btnAdd=document.createElement('button');
  btnAdd.innerText="Agregar "+titleEl.innerText;
  btnAdd.onclick=()=>openAddForm(currentView);
  container.appendChild(btnAdd);

  const div=document.createElement('div'); div.className='table-container';
  const table=document.createElement('table');
  const thead=document.createElement('thead');
  const tbody=document.createElement('tbody');

  if(currentView==='inventario'){
    thead.innerHTML=`<tr><th>Código</th><th>Serie</th><th>Equipo</th><th>Marca</th><th>Modelo</th><th>Categoría</th><th>Tienda</th><th>Acciones</th></tr>`;
    inventario.forEach((it,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${it.Codigo||''}</td><td>${it.Serie||''}</td><td>${it.Equipo||''}</td><td>${it.Marca||''}</td><td>${it.Modelo||''}</td><td>${it.Categoria||''}</td><td>${it.Tienda||''}</td>
      <td><button onclick="openAddForm('inventario',${i})">Editar</button>
      <button onclick="deleteItem('inventario',${i})">Eliminar</button></td>`;
      tbody.appendChild(tr);
    });
  } else if(currentView==='categoria'){
    thead.innerHTML='<tr><th>Nombre</th><th>Acciones</th></tr>';
    categorias.forEach((it,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${it.nombre||''}</td>
      <td><button onclick="openAddForm('categoria',${i})">Editar</button>
      <button onclick="deleteItem('categoria',${i})">Eliminar</button></td>`;
      tbody.appendChild(tr);
    });
  } else {
    thead.innerHTML='<tr><th>Nombre</th><th>Acciones</th></tr>';
    tiendas.forEach((it,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${it.nombre||''}</td>
      <td><button onclick="openAddForm('tienda',${i})">Editar</button>
      <button onclick="deleteItem('tienda',${i})">Eliminar</button></td>`;
      tbody.appendChild(tr);
    });
  }

  table.appendChild(thead); table.appendChild(tbody); div.appendChild(table); container.appendChild(div);
}

/* Modal */
function openAddForm(tipo,index=null){
  editItemIndex=(index!==null)?index:null;
  document.getElementById('modal').style.display='flex';
  const titleEl=document.getElementById('modal-title');
  const form=document.getElementById('modal-form');
  form.innerHTML=''; form.dataset.tipo=tipo;

  if(tipo==='inventario'){
    titleEl.innerText=(index!==null?'Editar':'Agregar')+' Inventario';
    const fields=['Codigo','Serie','Equipo','Marca','Modelo'];
    fields.forEach(k=>{
      const inp=document.createElement('input'); inp.placeholder=k; inp.id='f_'+k;
      form.appendChild(inp);
    });

    // Select Categoria
    const selCat=document.createElement('select'); selCat.id='f_Categoria';
    selCat.innerHTML='<option value="">-- Seleccionar Categoría --</option>';
    categorias.forEach(c=> selCat.innerHTML+=`<option value="${c.nombre}">${c.nombre}</option>`);
    form.appendChild(selCat);

    // Select Tienda
    const selT=document.createElement('select'); selT.id='f_Tienda';
    selT.innerHTML='<option value="">-- Seleccionar Tienda --</option>';
    tiendas.forEach(t=> selT.innerHTML+=`<option value="${t.nombre}">${t.nombre}</option>`);
    form.appendChild(selT);

    if(index!==null){
      const it=inventario[index]||{};
      fields.forEach(k=> document.getElementById('f_'+k).value=it[k]||'');
      selCat.value=it.Categoria||''; selT.value=it.Tienda||'';
    }
  } else {
    const name=tipo.charAt(0).toUpperCase()+tipo.slice(1);
    titleEl.innerText=(index!==null?'Editar ':'Agregar ')+name;
    const inp=document.createElement('input'); inp.placeholder='Nombre'; inp.id='f_nombre';
    form.appendChild(inp);
    if(index!==null){
      const item=(tipo==='categoria')?categorias[index]:tiendas[index];
      if(item) inp.value=item.nombre||'';
    }
  }
}
function closeModal(){ document.getElementById('modal').style.display='none'; }

function saveForm(){
  const tipo=document.getElementById('modal-form').dataset.tipo;
  if(tipo==='inventario'){
    const obj={
      Codigo:document.getElementById('f_Codigo').value,
      Serie:document.getElementById('f_Serie').value,
      Equipo:document.getElementById('f_Equipo').value,
      Marca:document.getElementById('f_Marca').value,
      Modelo:document.getElementById('f_Modelo').value,
      Categoria:document.getElementById('f_Categoria').value,
      Tienda:document.getElementById('f_Tienda').value
    };
    if(editItemIndex!==null){ inventario[editItemIndex]={...inventario[editItemIndex],...obj}; }
    else { inventario.push(obj); }
  } else {
    const obj={nombre:document.getElementById('f_nombre').value};
    if(editItemIndex!==null){
      if(tipo==='categoria') categorias[editItemIndex]=obj;
      else tiendas[editItemIndex]=obj;
    } else {
      if(tipo==='categoria') categorias.push(obj);
      else tiendas.push(obj);
    }
  }
  saveData(); render(); closeModal();
}

/* Eliminar */
function deleteItem(tipo,index){
  if(!confirm('¿Eliminar este registro?')) return;
  const arr=(tipo==='inventario')?inventario:(tipo==='categoria'?categorias:tiendas);
  arr.splice(index,1);
  saveData(); render();
}

loadData(); render();
</script>
</body>
</html>

